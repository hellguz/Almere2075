<./frontend\src\App.jsx>
import { useState, useEffect, useRef } from 'react';

// --- Configuration ---
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || '';

// --- Helper Functions & Components ---
const formatTime = () => new Date().toLocaleTimeString('en-GB');

const ProcessLog = ({ messages }) => {
  const logEndRef = useRef(null);
  useEffect(() => {
    logEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  return (
    <div className="process-log">
      <div className="log-header">PROCESS LOG</div>
      <div className="log-content">
        {messages.map((msg, i) => (
          <p key={i} className={`log-message ${msg.type || ''}`}>
            <span>{msg.time}</span>
            <span>{msg.text}</span>
          </p>
        ))}
        <div ref={logEndRef} />
      </div>
    </div>
  );
};

const ImageContainer = ({ src, label }) => (
  <div className="image-panel">
    <div className="image-header">{label}</div>
    <div className="image-container">
      {src ? <img src={src} alt={label} /> : <div className="placeholder">{label} will appear here.</div>}
    </div>
  </div>
);


// --- Main Workbench Component ---

function App() {
  // State
  const [galleryImages, setGalleryImages] = useState([]);
  const [selectedImage, setSelectedImage] = useState(null);
  const [outputImageUrl, setOutputImageUrl] = useState(null);
  const [logMessages, setLogMessages] = useState([{ time: formatTime(), text: 'Workbench initialized. Please select an image from the library.' }]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [error, setError] = useState('');

  // Initial gallery fetch
  useEffect(() => {
    const fetchGallery = async () => {
      try {
        const response = await fetch(`${API_BASE_URL}/gallery`);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        setGalleryImages(data);
      } catch (e) {
        addLogMessage(`Error fetching image library: ${e.message}`, 'error');
        setError('Could not load image library. Please refresh.');
      }
    };
    fetchGallery();
  }, []);

  // --- Core Functions ---
  const addLogMessage = (text, type = 'info') => {
    setLogMessages(prev => [...prev, { time: formatTime(), text, type }]);
  };

  const handleSelectImage = (image) => {
    if (isProcessing) return;
    setSelectedImage(image);
    setOutputImageUrl(null);
    setError('');
    setLogMessages([{ time: formatTime(), text: `Source image selected: ${image.filename}` }]);
  };

  const handleGenerate = async () => {
    if (!selectedImage) return;

    setIsProcessing(true);
    setOutputImageUrl(null);
    setError('');
    addLogMessage('--- Transformation process started ---', 'system');

    try {
      // Step 1: Get Base64
      addLogMessage('Step 1/3: Preparing source image...');
      const base64Reader = new Promise((resolve, reject) => {
          fetch(`${API_BASE_URL}/images/${selectedImage.filename}`)
              .then(res => res.blob())
              .then(blob => {
                  const reader = new FileReader();
                  reader.onload = () => resolve(reader.result);
                  reader.onerror = reject;
                  reader.readAsDataURL(blob);
              });
      });
      const base64Image = await base64Reader;
      addLogMessage('Source image prepared successfully.');

      // Step 2: Generate Prompt
      addLogMessage('Step 2/3: Generating AI prompt via GPT-4... (Est. 5-10 seconds)');
      const promptResponse = await fetch(`${API_BASE_URL}/generate-prompt`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ imageBase64: base64Image }),
      });
      if (!promptResponse.ok) throw new Error(`AI Prompt Generation failed: ${promptResponse.statusText}`);
      const promptData = await promptResponse.json();
      addLogMessage('AI prompt generated.', 'success');
      addLogMessage(`Prompt: "${promptData.prompt}"`, 'data');

      // Step 3: Transform Image
      addLogMessage('Step 3/3: Generating futuristic vision via FLUX.1... (Est. 30-45 seconds)');
      const transformResponse = await fetch(`${API_BASE_URL}/transform-image`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ imageBase64: base64Image, prompt: promptData.prompt }),
      });
      if (!transformResponse.ok) throw new Error(`AI Image Generation failed: ${transformResponse.statusText}`);
      const transformData = await transformResponse.json();
      
      setOutputImageUrl(transformData.transformedImageUrl);
      addLogMessage('--- Transformation Complete ---', 'success');

    } catch (err) {
      addLogMessage(`PROCESS FAILED: ${err.message}`, 'error');
      setError('An error occurred during the process. See log for details.');
    } finally {
      setIsProcessing(false);
    }
  };

  return (
    <div className="workbench-container">
      <aside className="library-panel">
        <div className="library-header">IMAGE LIBRARY</div>
        <div className="library-grid">
          {galleryImages.map(img => (
            <div
              key={img.filename}
              className={`grid-item ${selectedImage?.filename === img.filename ? 'selected' : ''}`}
              onClick={() => handleSelectImage(img)}
              title={img.filename}
            >
              {img.thumbnail ? (
                 <img src={`${API_BASE_URL}/thumbnails/${img.thumbnail}`} alt={img.filename} />
              ) : (
                <div className="thumb-placeholder">{img.filename.split('.').pop().toUpperCase()}</div>
              )}
            </div>
          ))}
        </div>
      </aside>

      <main className="main-panel">
        <div className="io-panel">
          <ImageContainer src={selectedImage ? `${API_BASE_URL}/images/${selectedImage.filename}`: null} label="SOURCE" />
          <div className="control-column">
             <button
                className="generate-button"
                onClick={handleGenerate}
                disabled={!selectedImage || isProcessing}
              >
                {isProcessing ? 'PROCESSING...' : 'ANALYZE & TRANSFORM'}
              </button>
              {error && <div className="error-box">{error}</div>}
          </div>
          <ImageContainer src={outputImageUrl} label="ALMERE 2075" />
        </div>
        <ProcessLog messages={logMessages} />
      </main>
    </div>
  );
}

export default App;


<./frontend\src\index.css>
/* --- WORKBENCH UX REDESIGN (From Scratch) --- */

/* 1. Foundational Styles */
:root {
  /* Typography */
  --font-family: 'Inter', -apple-system, sans-serif;
  --font-monospace: 'SF Mono', 'Fira Code', 'Roboto Mono', monospace;

  /* Color Palette (Scientific, functional, high-contrast) */
  --color-background: #f4f5f7; /* Light grey canvas */
  --color-surface: #ffffff;    /* White for panels */
  --color-border: #dfe1e6;
  --color-text-primary: #172b4d;
  --color-text-secondary: #6b778c;
  --color-accent: #0052cc; /* A professional, scientific blue */
  --color-accent-hover: #0065ff;
  --color-success: #00875a;
  --color-error: #de350b;
  --color-system: #42526e;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  font-family: var(--font-family);
  background-color: var(--color-background);
  color: var(--color-text-primary);
  font-size: 14px;
}

/* 2. Main Workbench Layout */
.workbench-container {
  display: flex;
  height: 100vh;
}

.library-panel {
  width: 240px;
  flex-shrink: 0;
  background: var(--color-surface);
  border-right: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
}

.main-panel {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  padding: 16px;
  gap: 16px;
}

/* 3. Library Panel Styles */
.library-header, .image-header, .log-header {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  color: var(--color-text-secondary);
  padding: 12px 16px;
  border-bottom: 1px solid var(--color-border);
  flex-shrink: 0;
}

.library-grid {
  padding: 8px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  overflow-y: auto;
}

.grid-item {
  aspect-ratio: 1 / 1;
  border-radius: 4px;
  cursor: pointer;
  border: 2px solid transparent;
  background: var(--color-background);
  transition: border-color 0.2s ease;
}
.grid-item.selected {
  border-color: var(--color-accent);
}
.grid-item:hover {
  border-color: var(--color-accent-hover);
}
.grid-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 2px;
}
.thumb-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font-size: 11px;
  color: var(--color-text-secondary);
  font-weight: 500;
}

/* 4. Main Panel Styles */
.io-panel {
  display: grid;
  grid-template-columns: 1fr 200px 1fr;
  gap: 16px;
  flex-grow: 1;
  min-height: 0; /* Important for flexbox shrinking */
}

.image-panel {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.image-container {
  flex-grow: 1;
  padding: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 0;
}
.image-container img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain; /* Fulfills user request */
}
.placeholder {
  color: var(--color-text-secondary);
}

.control-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 16px;
}

.generate-button {
  width: 100%;
  padding: 12px;
  font-size: 14px;
  font-weight: 600;
  background: var(--color-accent);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s ease;
}
.generate-button:hover:not(:disabled) {
  background: var(--color-accent-hover);
}
.generate-button:disabled {
  background: #091e420f;
  color: #a5adba;
  cursor: not-allowed;
}
.error-box {
    background: #fffae6;
    color: #974f0c;
    border: 1px solid #fffae6;
    padding: 8px;
    font-size: 12px;
    text-align: center;
    border-radius: 4px;
}

/* 5. Process Log Styles */
.process-log {
  height: 200px;
  flex-shrink: 0;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  display: flex;
  flex-direction: column;
}
.log-content {
  flex-grow: 1;
  overflow-y: auto;
  padding: 8px 16px;
  font-family: var(--font-monospace);
  font-size: 13px;
}
.log-message {
  margin: 4px 0;
  display: grid;
  grid-template-columns: 80px 1fr;
  gap: 16px;
}
.log-message span:first-child {
  color: var(--color-text-secondary);
}
.log-message.system span:last-child {
  font-weight: bold;
  color: var(--color-system);
}
.log-message.success span:last-child {
  color: var(--color-success);
}
.log-message.error span:last-child {
  color: var(--color-error);
  font-weight: bold;
}
.log-message.data span:last-child {
    font-style: italic;
    color: var(--color-text-secondary);
}